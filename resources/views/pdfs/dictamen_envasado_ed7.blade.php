<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Dictamen de Cumplimiento NOM de Mezcal Envasado</title>
    <style>
        body {
            font-family: 'calibri';
            margin-left: 20px;
            margin-right: 20px;
        }

        .header {
            margin-top: -30px;
            width: 100%;
        }

        .header img {
            display: block;
            width: 275px;
            
        }

        .container {
            margin-top: 0px;
            position: relative;
        }

        .description1,
        .description2,
        .description3,
        .textimg {
            position: absolute;
            right: 10px;
            text-align: right;
        }
        .description-container {
     margin-top: 20px; /* 🔹 Espacio entre el logo y el texto */
    width: 80%; /* 🔹 Controla el ancho del texto */
    text-align: center;
}

        .description1 {
            font-size: 18px;
            color: #151442;
            font-family: 'Arial Negrita' !important;
            top: 5px;
            
        }

        .description2 {
            color: #151442;
            font-family: 'Arial Negrita' !important;
            font-size: 9.5px;
            top: 30px;
           
        }

        .description3 {
            font-size: 10px;
            top: 42px;
            margin-right: 60px;
            
        }

        .title {
            font-family: 'Arial Negrita', Gadget, sans-serif;
            text-align: center;
            font-size: 20px;
            line-height: 20px;
            margin-top: -35px;
        }

        .subtema {
            font-size: 14px;
            margin-top: -25px;
            margin-left: 0px;
            margin-right: 30px;
            color: #002800;
            font-family: 'Arial Negrita'
        }

        .subtema2 {
            font-size: 14px;
            margin-top: 0px;
            margin-bottom: 15px;
            margin-left: 0px;
            margin-right: 30px;
            color: #002800;
            font-family: 'Arial Negrita'
        }

        .text {
            text-align: justify;
            font-size: 17px;
            margin-top: -25px;
            margin-left: 0px;
            margin-right: 15px;
            line-height: 0.8;
        }

        .text2 {
            text-align: justify;
            font-size: 15px;
            margin-left: 5px;
            margin-right: 80px;
            margin-top: -1px;
            line-height: 0.8;
        }

        table {
            width: 93%;
            border: 2px solid #003300;
            border-collapse: collapse;
            margin: auto;
            margin-left: 0px;
            margin-top: -15px;
            font-size: 12px;
            line-height: 1;
            vertical-align: top;
        }

        td,
        th {
            border: 2px solid #003300;
            padding: 3px;
            vertical-align: top;
            word-wrap: break-word;
            text-align: center;
            vertical-align: middle;
        }

        td {
            width: 50%;
        }

        .images-container {
            position: relative;
            display: flex;
            margin-top: 12px;
            margin-left: 30px;
            width: 100%;
        }

        .image-left {
            margin-right: 60%;
            width: 12%;
        }

        .textsello {
            text-align: left;
            font-size: 8px;
            margin: 0;
            padding: 0;
        }

        .numpag {
            font-size: 10px;
            position: fixed;
            bottom: 10px;
            right: 15px;
            margin: 0;
            padding: 0;
        }

        .sello {
            text-align: right;
            font-size: 11px;
            margin: 0;
            padding: 0;
            position: absolute;
            right: 20px;
            top: 860px;
            font-family: 'Arial Negrita' !important;
        }

        .container {
            margin-top: 0px;
            position: relative;
        }

        .textx,
        .textsello {
            line-height: 1.2;
            font-family: Arial, Helvetica, Verdana;
            margin-left: 30px;
        }

        .image-right {
            position: absolute;
            right: 10px;
            top: -20px;
            width: 240px;
        }


        .footer-bar {
            position: fixed;
            bottom: -55px;
            left: -70px;
            right: -70px;
            width: calc(100% - 40px);
            height: 45px;
            background-color: #158F60;
            color: white;
            font-size: 10px;
            text-align: center;
            padding: 10px 0px;
        }

        .footer-bar p {
            margin: 0;
            line-height: 1;
        }

        .font-lucida-sans-seminegrita {
            font-family: 'Lucida Sans Seminegrita', sans-serif;
        }

        .pie {
            text-align: right;
            font-size: 9px;
            line-height: 1;
            position: fixed;
            bottom: -12;
            left: 0;
            right: 0;
            width: calc(100% - 40px);
            height: 45px;
            margin-right: 30px;
            padding: 10px 0px;
            font-family: 'Lucida Sans Unicode';
        }

        .column {
            text-align: center;
            font-family: 'lucida sans seminegrita';
            color: #003366;
        }

        .colum-title {
            font-size: 12px;
            text-align: center;
            font-family: 'Calibri', sans-serif;
            font-weight: normal; 
            
        }
       

        .column2 {
            color: #003366;
            text-align: center;
            font-family: 'lucida sans seminegrita';
        }


        .textimg {
            font-weight: bold;
            position: absolute;
            top: 100px;
            left: 10px;
            text-align: left;
            font-size: 13px;
        }

        .watermark {
            color: red;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg) scaleY(1.2);
            opacity: 0.5;
            /* Opacidad predeterminada */
            letter-spacing: 3px;
            font-size: 150px;
            white-space: nowrap;
            z-index: -1;
        }
        .primera-tabla {
    border: 2px solid #1e6364;
     width: 98% !important; 
}

.primera-tabla td, .primera-tabla th {
    border: 2px solid #1e6364; 
}
.segunda-tabla {
    width: 100% !important;
    max-width: none;
    margin-left: 0;
    margin-right:0;}
    </style>
</head>

<body>

    @if ($watermarkText)
        <div class="watermark">
            Cancelado
        </div>
    @endif

    <div class="container">
        <div class="header">
            <img src="{{ public_path('img_pdf/UVEM_logo.png') }}" alt="Logo UVEM" width="275px">
        </div>
       <br>
    <div class="description1" >Unidad de Inspección  No. UVNOM-129</div>
<div class="description2" >Centro de Innovación y Desarrollo Agroalimentario de Michoacán, A.C.</div>
<div class="description3" >Acreditados ante la Entidad Mexicana de Acreditación, A.C.</div>

        <div class="title">Dictamen de Cumplimiento NOM de Mezcal Envasado </div>

        <p class="text" style="margin-bottom: 30px;"> La Unidad de Inspección CIDAMA.C. con domicilio en Kilómetro 8 Antigua Carretera a Pátzcuaro,
     S/N Colonia Otra no Especificada en el Catálogo, C.P. 58341, Morelia, Michoacán. Unidad de Inspección tipo A.</p>

        <p class="subtema" >I. &nbsp;&nbsp;&nbsp;&nbsp;Datos de la empresa</p>

      <table class="primera-tabla" style=" text-align: center; ">
    <tbody>
        <tr>
            <td class="column" style="width: 20%; vertical-align: middle;">Nombre de la empresa</td>
            <td colspan="3" style="width: 80%; vertical-align: middle;">{{ $data->inspeccion?->solicitud?->empresa?->razon_social ?? 'No encontrado' }}</td>
        </tr>
        <tr>
            <td class="column" style="width: 20%; vertical-align: middle;">Representante legal</td>
            <td style="width: 39%; vertical-align: middle;">{{ $data->inspeccion?->solicitud?->empresa?->representante ?? 'No encontrado' }}</td>
            <td class="column" style="width: 16%; vertical-align: middle;">Número de dictamen</td>
            <td style="width: 25%; vertical-align: middle;">{{ $data->num_dictamen ?? 'No encontrado' }}</td>
        </tr>
        <tr>
            <td class="column" style="width: 20%; vertical-align: middle; ">Dirección</td>
            <td style="width: 39%; vertical-align: middle; text-align: left;">{{ $data->inspeccion?->solicitud?->empresa?->domicilio_fiscal ?? 'No encontrado' }}</td>
            <td class="column" style="width: 16%; vertical-align: middle;">Fecha de emisión</td>
            <td style="width: 25%; vertical-align: middle;">{{ $fecha_emision ?? '' }}</td>
        </tr>
        <tr>
            <td class="column" style="width: 20%; vertical-align: middle;">RFC</td>
            <td style="width: 39%; vertical-align: middle;">{{ $data->inspeccion?->solicitud?->empresa?->rfc ?? 'No encontrado' }}</td>
            <td class="column" style="width: 16%; vertical-align: middle;">Fecha de vencimiento</td>
            <td style="width: 25%; vertical-align: middle;">{{ $fecha_vigencia ?? '' }}</td>
        </tr>
        <tr>
            <td class="column" style="width: 20%; vertical-align: middle;">No. servicio</td>
            <td style="width: 39%; vertical-align: middle;">{{ $data->inspeccion?->num_servicio ?? 'No encontrado' }}</td>
            <td class="column" style="width: 16%; vertical-align: middle;">Fecha del servicio</td>
            <td style="width: 25%; vertical-align: middle;">{{ $fecha_servicio }}</td>
        </tr>
    </tbody>
</table>

</table>
        <p class="subtema2">II. &nbsp;&nbsp;&nbsp;&nbsp;Descripción del producto</p>

     <table class="segunda-tabla">
    <tbody>
        <tr>
            <td colspan="8" class="colum-title"><strong>PRODUCTO:</strong>
                @if ($lotesGranel->isNotEmpty())
                    @foreach ($lotesGranel as $loteGranel)
                        {{ $loteGranel->categoria->categoria ?? 'No encontrado' }}
                        @if (!$loop->last), @endif
                    @endforeach
                @else
                    --
                @endif
                <br><strong>ORIGEN:</strong> 
                {{ $data->inspeccion->solicitud->instalacion->estados->nombre ?? 'N/A' }}
            </td>
        </tr>
        <tr>
            <td class="column2">No. de Certificado NOM a Granel</td>
            <td>{{ $data->certificado_nom_granel ?? 'N/A' }}</td>
            <td class="column2">No. de Lote a Granel</td>
            <td>
                @if ($lotesGranel->isNotEmpty())
                    @foreach ($lotesGranel as $loteGranel)
                        {{ $loteGranel->nombre_lote ?? 'N/A' }}
                        @if (!$loop->last), @endif
                    @endforeach
                @else
                    N/A
                @endif
            </td>
            <td class="column2">No. de Análisis</td>
            <td>
                @if ($lotesGranel->isNotEmpty())
                    @foreach ($lotesGranel as $loteGranel)
                        {{ $loteGranel->folio_fq ?? 'N/A' }}
                        @if (!$loop->last), @endif
                    @endforeach
                @else
                    N/A
                @endif
            </td>
            <td class="column2">Contenido Alcohólico</td>
            <td>
                @if ($lotesGranel->isNotEmpty())
                    @foreach ($lotesGranel as $loteGranel)
                        {{ $loteGranel->cont_alc ?? 'N/A' }}% Alc. Vol.
                        @if (!$loop->last), @endif
                    @endforeach
                @else
                    N/A
                @endif
            </td>
        </tr>
      <tr>
            <td class="column2" style="text-align: center; height: 30px; padding: 3px; line-height: 1;">Categoría y Clase</td>
            <td style="text-align: center;">
                @if ($lotesGranel->isNotEmpty())
                    @foreach ($lotesGranel as $loteGranel)
                        {{ $loteGranel->categoria->categoria ?? 'N/A' }},
                        {{ $loteGranel->clase->clase ?? 'N/A' }}
                        @if (!$loop->last), @endif
                    @endforeach
                @else
                    N/A
                @endif
            </td>
            <td rowspan="2" class="column2" style="text-align: center; vertical-align: middle;">No. de Lote Envasado</td>
            <td rowspan="2" style="text-align: center; vertical-align: middle;">{{ $data->lote_envasado->nombre ?? 'No encontrado' }}</td>
            <td rowspan="2" class="column2" style="text-align: center; vertical-align: middle;">No. de Botellas</td>
            <td rowspan="2" style="text-align: center; vertical-align: middle;">{{ $data->lote_envasado->cant_botellas ?? 'N/A' }}</td>
            <td rowspan="2" class="column2" style="text-align: center; vertical-align: middle;">Presentación</td>
            <td rowspan="2" style="text-align: center; vertical-align: middle;">{{ $data->lote_envasado->presentacion ?? 'N/A' }}</td>
        </tr>
        <tr>
            <td class="column2" style="text-align: center;">Tipo de Maguey</td>
            <td style="text-align: center;">
                @if ($lotesGranel->isNotEmpty())
                    @foreach ($lotesGranel as $loteGranel)
                        @php
                            $tipos = $loteGranel->tiposRelacionados ?? collect();
                        @endphp
                        @if ($tipos->isNotEmpty())
                            @foreach ($tipos as $tipo)
                                {{ $tipo->nombre }} <i>({{ $tipo->cientifico }})</i>
                                @if (!$loop->last), @endif
                            @endforeach
                        @else
                            No encontrado
                        @endif
                        @if (!$loop->last), @endif
                    @endforeach
                @else
                    N/A
                @endif
        <tr>
            <td class="column2">Ingredientes</td>
            <td>
                @if ($lotesGranel->isNotEmpty())
                    @foreach ($lotesGranel as $loteGranel)
                        {{ !empty($loteGranel->ingredientes) ? $loteGranel->ingredientes : '----' }}
                        @if (!$loop->last), @endif
                    @endforeach
                @else
                    N/A
                @endif
            </td>
            <td class="column2">Edad</td>
            <td>
                @if ($lotesGranel->isNotEmpty())
                    @foreach ($lotesGranel as $loteGranel)
                        {{ !empty($loteGranel->edad) ? $loteGranel->edad : '----' }}
                        @if (!$loop->last), @endif
                    @endforeach
                @else
                    N/A
                @endif
            </td>
            <td class="column2">Marca</td>
            <td>{{ $marca->marca ?? 'N/A' }}</td>
            <td class="column2">Volumen del Lote Envasado</td>
            <td>
                {{ $data->lote_envasado->volumen_total ?? 'No encontrado' }} L
            </td>
        </tr>
    </tbody>
</table>


        <p class="text2">Este dictamen de cumplimiento de lote de mezcal envasado se expide de acuerdo a la
            Norma Oficial Mexicana NOM-070-SCFI-2016. Bebidas alcohólicas -mezcal-
            especificaciones.</p>


<!--FIRMA DIGITAL-->
<div style="margin-left: -5px;">
    <p class="sello">Sello de Unidad de Inspección</p>
        <div class="images-container">
            <img src="{{ $qrCodeBase64 }}" alt="QR" width="90px">
            <img src="{{ public_path('img_pdf/Sello ui.png') }}" alt="Logo UI" class="image-right">
        </div>
        <p class="textx" style="font-size: 9px; margin-bottom:-8px; margin-top:-2px; position: relative;">
            <strong>AUTORIZÓ</strong>
            <span style="margin-left: 53px; display: inline-block; text-align: center; position: relative;">
                @php
                    use Illuminate\Support\Facades\Storage;
                    $firma = $data->firmante->firma ?? null;
                    $firmaPath = $firma ? 'firmas/' . $firma : null;
                @endphp
        
                @if ($firma && Storage::disk('public')->exists($firmaPath))
                    <img style="position: absolute; top: -45px; left: 170; right: 0; margin: 0 auto;" height="60px"
                        {{-- src="{{ asset('storage/' . $firmaPath) }}"> --}}
                        src="{{ public_path('storage/' . $firmaPath) }}">
                @endif
        
                <strong>{{ $data->firmante->puesto ?? '' }} | {{ $data->firmante->name ?? '' }}</strong>
            </span>
        </p>
        
        <p class="textx" style="font-size: 9px; margin-bottom:-8px">
            <strong>CADENA ORIGINAL</strong>
            <span style="margin-left: 14px;">
       @if (isset($firmaDigital['firma']))
    <p class="textsello">
        {{ $firmaDigital['firma'] }}
    </p>
@else
    
@endif
            </span>
        </p>

        <p class="textx" style="font-size: 9px; margin-bottom:1px">
            <strong>SELLO DIGITAL</strong>
        </p>

       @if (isset($firmaDigital['firma']))
    <p class="textsello" style="width: 85%; word-wrap: break-word; white-space: normal;">
        {{ $firmaDigital['firma'] }}
    </p>
@else
    <p class="textsello">Error: No se pudo generar la firma digital</p>
@endif

    <div class="footer-bar">
        <p class="font-lucida-sans-seminegrita">www.cidam.org . unidadverificacion@cidam.org</p>
        <p>Kilómetro 8, Antigua Carretera a Pátzcuaro S/N. Col. Otra no especificada en el catálogo C.P. 58341.
            Morelia Michoacán</p>
    </div> 

    <p class="pie">Entrada en vigor: 10-12-2024<br>
        F-UV-04-17 Ver 7.
    </p>
    
</div>




</body>
</html>
